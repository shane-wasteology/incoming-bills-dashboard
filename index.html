<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Incoming Bills Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/recharts@2.10.3/umd/Recharts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', -apple-system, sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script>
    const { useState } = React;
    const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, BarChart, Bar, Cell, ReferenceLine } = Recharts;

    const colors = {
      bg: '#1e2a38',
      bgLight: '#2a3a4d',
      border: '#3d4f63',
      green: '#4A9B52',
      text: '#e2e8f0',
      textMuted: '#94a3b8',
      textDim: '#64748b',
      amber: '#f59e0b',
      red: '#ef4444',
    };

    function App() {
      const [dailyData, setDailyData] = useState([]);
      const [monthlyData, setMonthlyData] = useState({});
      const [alertsData, setAlertsData] = useState([]);
      const [vendors, setVendors] = useState(['All Vendors']);
      const [dataLoaded, setDataLoaded] = useState({ daily: false, monthly: false, alerts: false });
      const [activeTab, setActiveTab] = useState('daily');
      const [selectedVendor, setSelectedVendor] = useState('All Vendors');

      const handleDailyCSV = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        Papa.parse(file, {
          header: true,
          complete: (results) => {
            const parsed = results.data.filter(row => row.day && row.count).map(row => ({
              day: row.day,
              count: parseInt(row.count) || 0,
              isWeekend: row.isWeekend === 'true' || row.isWeekend === '1'
            }));
            setDailyData(parsed);
            setDataLoaded(prev => ({ ...prev, daily: true }));
          }
        });
      };

      const handleMonthlyCSV = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        Papa.parse(file, {
          header: true,
          complete: (results) => {
            const grouped = {};
            const vendorSet = new Set(['All Vendors']);
            results.data.filter(row => row.month && row.vendor && row.count).forEach(row => {
              vendorSet.add(row.vendor);
              if (!grouped[row.vendor]) grouped[row.vendor] = [];
              grouped[row.vendor].push({ month: row.month, count: parseInt(row.count) || 0 });
            });
            setMonthlyData(grouped);
            setVendors(Array.from(vendorSet));
            setDataLoaded(prev => ({ ...prev, monthly: true }));
          }
        });
      };

      const handleAlertsCSV = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        Papa.parse(file, {
          header: true,
          complete: (results) => {
            const parsed = results.data.filter(row => row.vendor && row.priorCount && row.currentCount).map(row => ({
              vendor: row.vendor,
              priorMonth: row.priorMonth || 'Prior',
              priorCount: parseInt(row.priorCount) || 0,
              currentMonth: row.currentMonth || 'Current',
              currentCount: parseInt(row.currentCount) || 0,
              pct: parseFloat(row.pct) || (parseInt(row.currentCount) / parseInt(row.priorCount) * 100)
            }));
            setAlertsData(parsed);
            setDataLoaded(prev => ({ ...prev, alerts: true }));
          }
        });
      };

      const mtdTotal = dailyData.reduce((sum, d) => sum + d.count, 0);
      const dailyAvg = dailyData.length ? Math.round(mtdTotal / dailyData.length) : 0;
      const yesterdayCount = dailyData.length ? dailyData[dailyData.length - 1]?.count : 0;
      const alertCount = alertsData.length;
      const currentMonthlyData = monthlyData[selectedVendor] || monthlyData['All Vendors'] || [];
      const ytdTotal = (monthlyData['All Vendors'] || []).reduce((s, d) => s + d.count, 0);
      const allLoaded = dataLoaded.daily && dataLoaded.monthly && dataLoaded.alerts;

      const s = {
        container: { minHeight: '100vh', background: `linear-gradient(180deg, ${colors.bg} 0%, #151f2b 100%)`, padding: '24px', color: colors.text },
        loaderContainer: { minHeight: '100vh', background: `linear-gradient(180deg, ${colors.bg} 0%, #151f2b 100%)`, padding: '40px', color: colors.text },
        loaderTitle: { fontSize: '20px', fontWeight: '600', color: colors.green, letterSpacing: '2px', marginBottom: '32px', textTransform: 'uppercase' },
        loaderGrid: { display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '24px', maxWidth: '900px' },
        loaderCard: { background: colors.bgLight, border: `1px solid ${colors.border}`, borderRadius: '8px', padding: '20px' },
        loaderCardLoaded: { background: colors.bgLight, border: `1px solid ${colors.green}`, borderRadius: '8px', padding: '20px' },
        loaderLabel: { fontSize: '12px', color: colors.textMuted, textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '12px' },
        loaderDesc: { fontSize: '11px', color: colors.textDim, marginBottom: '16px', lineHeight: '1.5' },
        fileInput: { display: 'block', width: '100%', padding: '10px', background: colors.bg, border: `1px dashed ${colors.border}`, borderRadius: '4px', color: colors.textMuted, fontSize: '12px', cursor: 'pointer' },
        loadedBadge: { display: 'inline-block', padding: '4px 10px', background: 'rgba(74, 155, 82, 0.2)', border: `1px solid ${colors.green}`, borderRadius: '4px', color: colors.green, fontSize: '11px', fontWeight: '600' },
        header: { display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '24px', borderBottom: `1px solid ${colors.border}`, paddingBottom: '16px' },
        logo: { width: '44px', height: '44px', borderRadius: '8px', background: colors.green, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff', fontWeight: '700', fontSize: '18px' },
        title: { fontSize: '18px', fontWeight: '600', color: colors.green, letterSpacing: '2px', textTransform: 'uppercase' },
        subtitle: { fontSize: '12px', color: colors.textDim, marginTop: '2px' },
        kpiRow: { display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '16px', marginBottom: '24px' },
        kpiCard: { background: colors.bgLight, border: `1px solid ${colors.border}`, borderRadius: '8px', padding: '16px' },
        kpiLabel: { fontSize: '10px', color: colors.textDim, textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '8px' },
        kpiValue: { fontSize: '28px', fontWeight: '700', color: colors.green },
        kpiValueAlert: { fontSize: '28px', fontWeight: '700', color: colors.amber },
        kpiSub: { fontSize: '11px', color: colors.textDim, marginTop: '4px' },
        tabRow: { display: 'flex', gap: '4px', marginBottom: '20px', borderBottom: `1px solid ${colors.border}`, paddingBottom: '12px' },
        tab: { padding: '8px 16px', fontSize: '12px', fontWeight: '500', textTransform: 'uppercase', letterSpacing: '1px', border: 'none', borderRadius: '4px', cursor: 'pointer', fontFamily: 'inherit' },
        tabActive: { background: colors.green, color: '#fff' },
        tabInactive: { background: 'transparent', color: colors.textDim, border: `1px solid ${colors.border}` },
        panel: { background: colors.bgLight, border: `1px solid ${colors.border}`, borderRadius: '8px', padding: '20px' },
        panelHeader: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' },
        panelTitle: { fontSize: '13px', fontWeight: '600', color: colors.textMuted, textTransform: 'uppercase', letterSpacing: '1px' },
        select: { background: colors.bg, border: `1px solid ${colors.border}`, borderRadius: '4px', padding: '6px 12px', fontSize: '12px', color: colors.text, cursor: 'pointer', minWidth: '180px' },
        chartContainer: { height: '300px', marginBottom: '16px' },
        infoBox: { marginTop: '16px', padding: '10px 14px', background: 'rgba(74, 155, 82, 0.1)', border: '1px solid rgba(74, 155, 82, 0.2)', borderRadius: '6px', fontSize: '11px', color: colors.green },
        statGrid: { display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '12px', marginTop: '16px' },
        statBox: { background: colors.bg, border: `1px solid ${colors.border}`, borderRadius: '6px', padding: '12px' },
        statLabel: { fontSize: '10px', color: colors.textDim, textTransform: 'uppercase', letterSpacing: '0.5px' },
        statValue: { fontSize: '18px', fontWeight: '700', color: colors.green, marginTop: '4px' },
        table: { width: '100%', borderCollapse: 'collapse', fontSize: '12px' },
        th: { textAlign: 'left', padding: '10px 12px', color: colors.textDim, fontWeight: '500', textTransform: 'uppercase', fontSize: '10px', borderBottom: `1px solid ${colors.border}` },
        thRight: { textAlign: 'right', padding: '10px 12px', color: colors.textDim, fontWeight: '500', textTransform: 'uppercase', fontSize: '10px', borderBottom: `1px solid ${colors.border}` },
        td: { padding: '10px 12px', borderBottom: `1px solid ${colors.bg}`, color: colors.text },
        tdRight: { padding: '10px 12px', borderBottom: `1px solid ${colors.bg}`, textAlign: 'right' },
        badge: { display: 'inline-block', padding: '3px 8px', borderRadius: '4px', fontSize: '10px', fontWeight: '600', textTransform: 'uppercase', background: 'rgba(239, 68, 68, 0.2)', color: colors.red, border: '1px solid rgba(239, 68, 68, 0.3)' },
        alertBox: { marginTop: '20px', padding: '12px 16px', background: 'rgba(245, 158, 11, 0.1)', border: '1px solid rgba(245, 158, 11, 0.3)', borderRadius: '6px', fontSize: '11px', color: colors.amber },
      };

      const CustomTooltip = ({ active, payload, label }) => {
        if (active && payload && payload.length) {
          return React.createElement('div', { style: { background: colors.bg, border: `1px solid ${colors.green}`, borderRadius: '4px', padding: '8px 12px', fontSize: '11px' } }, [
            React.createElement('div', { key: 'l', style: { color: colors.textMuted, marginBottom: '4px' } }, label),
            React.createElement('div', { key: 'v', style: { color: colors.green, fontWeight: '600' } }, payload[0].value.toLocaleString() + ' invoices')
          ]);
        }
        return null;
      };

      if (!allLoaded) {
        return React.createElement('div', { style: s.loaderContainer }, [
          React.createElement('h1', { key: 't', style: s.loaderTitle }, 'Incoming Bills Dashboard'),
          React.createElement('p', { key: 'd', style: { color: colors.textMuted, marginBottom: '32px' } }, 'Load your CSV files to populate the dashboard'),
          React.createElement('div', { key: 'g', style: s.loaderGrid }, [
            React.createElement('div', { key: 'd1', style: dataLoaded.daily ? s.loaderCardLoaded : s.loaderCard }, [
              React.createElement('div', { key: 'l', style: s.loaderLabel }, 'Daily MTD'),
              React.createElement('div', { key: 'd', style: s.loaderDesc }, 'Columns: day, count, isWeekend'),
              dataLoaded.daily ? React.createElement('span', { key: 'b', style: s.loadedBadge }, '✓ Loaded (' + dailyData.length + ' rows)') : React.createElement('input', { key: 'i', type: 'file', accept: '.csv', onChange: handleDailyCSV, style: s.fileInput })
            ]),
            React.createElement('div', { key: 'd2', style: dataLoaded.monthly ? s.loaderCardLoaded : s.loaderCard }, [
              React.createElement('div', { key: 'l', style: s.loaderLabel }, 'Monthly Trend'),
              React.createElement('div', { key: 'd', style: s.loaderDesc }, 'Columns: month, vendor, count'),
              dataLoaded.monthly ? React.createElement('span', { key: 'b', style: s.loadedBadge }, '✓ Loaded (' + vendors.length + ' vendors)') : React.createElement('input', { key: 'i', type: 'file', accept: '.csv', onChange: handleMonthlyCSV, style: s.fileInput })
            ]),
            React.createElement('div', { key: 'd3', style: dataLoaded.alerts ? s.loaderCardLoaded : s.loaderCard }, [
              React.createElement('div', { key: 'l', style: s.loaderLabel }, 'Alerts'),
              React.createElement('div', { key: 'd', style: s.loaderDesc }, 'Columns: vendor, priorMonth, priorCount, currentMonth, currentCount, pct'),
              dataLoaded.alerts ? React.createElement('span', { key: 'b', style: s.loadedBadge }, '✓ Loaded (' + alertsData.length + ' alerts)') : React.createElement('input', { key: 'i', type: 'file', accept: '.csv', onChange: handleAlertsCSV, style: s.fileInput })
            ]),
          ])
        ]);
      }

      return React.createElement('div', { style: s.container }, [
        React.createElement('div', { key: 'h', style: s.header }, [
          React.createElement('div', { key: 'l', style: s.logo }, 'W'),
          React.createElement('div', { key: 't' }, [
            React.createElement('h1', { key: 'ti', style: s.title }, 'Incoming Bills'),
            React.createElement('div', { key: 'su', style: s.subtitle }, 'Data through ' + (dailyData.length ? dailyData[dailyData.length - 1].day : '') + '/2025')
          ])
        ]),
        React.createElement('div', { key: 'k', style: s.kpiRow }, [
          React.createElement('div', { key: 'k1', style: s.kpiCard }, [React.createElement('div', { key: 'l', style: s.kpiLabel }, 'Yesterday'), React.createElement('div', { key: 'v', style: s.kpiValue }, yesterdayCount.toLocaleString()), React.createElement('div', { key: 's', style: s.kpiSub }, dailyData.length ? dailyData[dailyData.length - 1].day : '')]),
          React.createElement('div', { key: 'k2', style: s.kpiCard }, [React.createElement('div', { key: 'l', style: s.kpiLabel }, 'MTD Total'), React.createElement('div', { key: 'v', style: s.kpiValue }, mtdTotal.toLocaleString()), React.createElement('div', { key: 's', style: s.kpiSub }, dailyData.length + ' days')]),
          React.createElement('div', { key: 'k3', style: s.kpiCard }, [React.createElement('div', { key: 'l', style: s.kpiLabel }, 'Year to Date'), React.createElement('div', { key: 'v', style: s.kpiValue }, ytdTotal.toLocaleString()), React.createElement('div', { key: 's', style: s.kpiSub }, 'Completed months')]),
          React.createElement('div', { key: 'k4', style: s.kpiCard }, [React.createElement('div', { key: 'l', style: s.kpiLabel }, 'Alerts'), React.createElement('div', { key: 'v', style: alertCount > 0 ? s.kpiValueAlert : s.kpiValue }, alertCount), React.createElement('div', { key: 's', style: s.kpiSub }, 'vendors below 25%')]),
        ]),
        React.createElement('div', { key: 'tabs', style: s.tabRow }, ['daily', 'monthly', 'alerts'].map(tab => React.createElement('button', { key: tab, onClick: () => setActiveTab(tab), style: { ...s.tab, ...(activeTab === tab ? s.tabActive : s.tabInactive) } }, tab === 'daily' ? 'Daily MTD' : tab === 'monthly' ? 'Monthly Trend' : 'Alerts (' + alertCount + ')'))),
        activeTab === 'daily' && React.createElement('div', { key: 'dp', style: s.panel }, [
          React.createElement('div', { key: 'h', style: s.panelHeader }, [React.createElement('div', { key: 't', style: s.panelTitle }, 'Daily Invoice Count'), React.createElement('div', { key: 'a', style: { fontSize: '11px', color: colors.textMuted } }, 'Avg: ' + dailyAvg.toLocaleString() + '/day')]),
          React.createElement('div', { key: 'c', style: s.chartContainer }, React.createElement(ResponsiveContainer, { width: '100%', height: '100%' }, React.createElement(BarChart, { data: dailyData, margin: { left: 10, right: 10, top: 10, bottom: 10 } }, [React.createElement(CartesianGrid, { key: 'g', strokeDasharray: '3 3', stroke: colors.border, vertical: false }), React.createElement(XAxis, { key: 'x', dataKey: 'day', tick: { fill: colors.textDim, fontSize: 10 }, axisLine: { stroke: colors.border }, tickLine: false }), React.createElement(YAxis, { key: 'y', tick: { fill: colors.textDim, fontSize: 10 }, axisLine: { stroke: colors.border }, tickLine: false }), React.createElement(Tooltip, { key: 't', content: React.createElement(CustomTooltip) }), React.createElement(ReferenceLine, { key: 'r', y: dailyAvg, stroke: colors.amber, strokeDasharray: '5 5', strokeWidth: 2 }), React.createElement(Bar, { key: 'b', dataKey: 'count', radius: [4, 4, 0, 0] }, dailyData.map((e, i) => React.createElement(Cell, { key: i, fill: colors.green, opacity: e.isWeekend ? 0.4 : 1 })))]))),
          React.createElement('div', { key: 'i', style: s.infoBox }, 'Weekend days at reduced opacity. Orange line = daily average.'),
          React.createElement('div', { key: 's', style: s.statGrid }, [React.createElement('div', { key: 's1', style: s.statBox }, [React.createElement('div', { key: 'l', style: s.statLabel }, 'MTD Total'), React.createElement('div', { key: 'v', style: s.statValue }, mtdTotal.toLocaleString())]), React.createElement('div', { key: 's2', style: s.statBox }, [React.createElement('div', { key: 'l', style: s.statLabel }, 'Daily Avg'), React.createElement('div', { key: 'v', style: s.statValue }, dailyAvg.toLocaleString())]), React.createElement('div', { key: 's3', style: s.statBox }, [React.createElement('div', { key: 'l', style: s.statLabel }, 'Peak Day'), React.createElement('div', { key: 'v', style: s.statValue }, dailyData.length ? dailyData.reduce((m, d) => d.count > m.count ? d : m).day : '-')]), React.createElement('div', { key: 's4', style: s.statBox }, [React.createElement('div', { key: 'l', style: s.statLabel }, 'Peak Volume'), React.createElement('div', { key: 'v', style: s.statValue }, dailyData.length ? Math.max(...dailyData.map(d => d.count)).toLocaleString() : '-')])])
        ]),
        activeTab === 'monthly' && React.createElement('div', { key: 'mp', style: s.panel }, [
          React.createElement('div', { key: 'h', style: s.panelHeader }, [React.createElement('div', { key: 't', style: s.panelTitle }, 'Monthly Invoice Volume'), React.createElement('select', { key: 's', style: s.select, value: selectedVendor, onChange: (e) => setSelectedVendor(e.target.value) }, vendors.map(v => React.createElement('option', { key: v, value: v }, v)))]),
          React.createElement('div', { key: 'c', style: s.chartContainer }, React.createElement(ResponsiveContainer, { width: '100%', height: '100%' }, React.createElement(LineChart, { data: currentMonthlyData, margin: { left: 10, right: 20 } }, [React.createElement(CartesianGrid, { key: 'g', strokeDasharray: '3 3', stroke: colors.border }), React.createElement(XAxis, { key: 'x', dataKey: 'month', tick: { fill: colors.textDim, fontSize: 10 }, axisLine: { stroke: colors.border }, tickLine: false }), React.createElement(YAxis, { key: 'y', tick: { fill: colors.textDim, fontSize: 10 }, axisLine: { stroke: colors.border }, tickLine: false, tickFormatter: v => v >= 1000 ? (v/1000).toFixed(0) + 'k' : v }), React.createElement(Tooltip, { key: 't', content: React.createElement(CustomTooltip) }), React.createElement(Line, { key: 'l', type: 'monotone', dataKey: 'count', stroke: colors.green, strokeWidth: 2, dot: { fill: colors.green, r: 4 } })]))),
          React.createElement('div', { key: 'i', style: s.infoBox }, 'Showing completed months only.'),
          React.createElement('div', { key: 's', style: s.statGrid }, [React.createElement('div', { key: 's1', style: s.statBox }, [React.createElement('div', { key: 'l', style: s.statLabel }, 'YTD Total'), React.createElement('div', { key: 'v', style: s.statValue }, currentMonthlyData.reduce((a, d) => a + d.count, 0).toLocaleString())]), React.createElement('div', { key: 's2', style: s.statBox }, [React.createElement('div', { key: 'l', style: s.statLabel }, 'Monthly Avg'), React.createElement('div', { key: 'v', style: s.statValue }, currentMonthlyData.length ? Math.round(currentMonthlyData.reduce((a, d) => a + d.count, 0) / currentMonthlyData.length).toLocaleString() : '-')]), React.createElement('div', { key: 's3', style: s.statBox }, [React.createElement('div', { key: 'l', style: s.statLabel }, 'Peak Month'), React.createElement('div', { key: 'v', style: s.statValue }, currentMonthlyData.length ? currentMonthlyData.reduce((m, d) => d.count > m.count ? d : m).month : '-')]), React.createElement('div', { key: 's4', style: s.statBox }, [React.createElement('div', { key: 'l', style: s.statLabel }, 'Peak Volume'), React.createElement('div', { key: 'v', style: s.statValue }, currentMonthlyData.length ? Math.max(...currentMonthlyData.map(d => d.count)).toLocaleString() : '-')])])
        ]),
        activeTab === 'alerts' && React.createElement('div', { key: 'ap', style: s.panel }, [
          React.createElement('div', { key: 'h', style: s.panelHeader }, [React.createElement('div', { key: 't', style: s.panelTitle }, 'Vendors Below 25%'), React.createElement('div', { key: 'c', style: { fontSize: '11px', color: colors.textDim } }, alertsData.length + ' vendors flagged')]),
          alertsData.length === 0 ? React.createElement('div', { key: 'e', style: { textAlign: 'center', padding: '48px', color: colors.textDim } }, [React.createElement('div', { key: 'i', style: { fontSize: '32px', color: colors.green, marginBottom: '8px' } }, '✓'), React.createElement('div', { key: 't' }, 'No vendors below threshold')]) : [
            React.createElement('table', { key: 'tb', style: s.table }, [React.createElement('thead', { key: 'th' }, React.createElement('tr', null, [React.createElement('th', { key: 'h1', style: s.th }, 'Vendor'), React.createElement('th', { key: 'h2', style: s.thRight }, 'Prior'), React.createElement('th', { key: 'h3', style: s.thRight }, 'Current'), React.createElement('th', { key: 'h4', style: s.thRight }, '% of Prior'), React.createElement('th', { key: 'h5', style: s.thRight }, 'Status')])), React.createElement('tbody', { key: 'tb' }, alertsData.map((r, i) => React.createElement('tr', { key: i }, [React.createElement('td', { key: 'c1', style: s.td }, r.vendor), React.createElement('td', { key: 'c2', style: { ...s.tdRight, color: colors.textMuted } }, r.priorCount), React.createElement('td', { key: 'c3', style: { ...s.tdRight, color: colors.red, fontWeight: '600' } }, r.currentCount), React.createElement('td', { key: 'c4', style: { ...s.tdRight, color: colors.red } }, r.pct.toFixed(1) + '%'), React.createElement('td', { key: 'c5', style: s.tdRight }, React.createElement('span', { style: s.badge }, '↓ ' + (100 - r.pct).toFixed(0) + '% drop'))])))]),
            React.createElement('div', { key: 'al', style: s.alertBox }, '⚠ Action Required: Investigate reduced volume.'),
            React.createElement('div', { key: 'in', style: s.infoBox }, 'Alerts trigger on month close only.')
          ]
        ])
      ]);
    }

    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
  </script>
</body>
</html>
